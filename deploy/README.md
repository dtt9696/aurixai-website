# AURIX 跨境哨兵 — 阿里云部署指南（极简版）

本指南面向非技术背景用户，只需 **3 步** 即可完成部署。

---

## 你需要准备的东西

在开始之前，请确认你已经拥有以下信息。如果还没有，请按照下方表格中的获取方式操作。

| 序号 | 信息 | 获取方式 |
|------|------|----------|
| 1 | **ECS 公网 IP 地址** | 登录阿里云控制台 → 云服务器 ECS → 实例列表 → 找到你的实例 → 复制「公网 IP」 |
| 2 | **ECS root 密码** | 购买 ECS 时设置的密码。如果忘记了：实例列表 → 更多 → 密码/密钥 → 重置实例密码 |
| 3 | **域名**（可选） | 如果你已有域名，准备好即可。没有也可以先用 IP 访问，后续再配置 |

---

## 第 1 步：安装 sshpass（仅首次需要）

部署脚本需要一个小工具 `sshpass` 来自动登录服务器。请根据你的电脑系统执行对应命令。

**Mac 用户**：打开「终端」应用，粘贴以下命令并回车：

```bash
brew install hudochenkov/sshpass/sshpass
```

如果提示没有 `brew`，请先安装 Homebrew：

```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

**Windows 用户**：推荐使用 Git Bash（安装 Git for Windows 后自带）。在 Git Bash 中执行部署脚本即可，sshpass 会自动处理。如果遇到问题，也可以使用 WSL（Windows 子系统 Linux）：

```bash
sudo apt-get install -y sshpass
```

---

## 第 2 步：运行一键部署脚本

在终端中依次执行以下命令：

```bash
# 下载部署脚本
git clone https://github.com/dtt9696/aurixai-website.git
cd aurixai-website/deploy

# 给脚本执行权限
chmod +x setup-ecs.sh

# 运行部署脚本
./setup-ecs.sh
```

脚本会依次询问你以下信息（直接输入后回车即可）：

1. **ECS 服务器公网 IP 地址** — 粘贴你的 ECS IP
2. **ECS root 密码** — 输入时屏幕不会显示，这是正常的安全行为
3. **域名** — 如果有就输入，没有直接回车跳过
4. **邮箱** — 用于 HTTPS 证书，没有域名可跳过

脚本会自动完成所有安装和配置，整个过程大约需要 **3-5 分钟**。

---

## 第 3 步：验证部署成功

部署完成后，在浏览器中访问以下地址：

**如果配置了域名：**

```
https://你的域名/health
```

**如果没有域名（用 IP 访问）：**

```
http://你的ECS_IP/health
```

如果看到类似以下内容，说明部署成功：

```json
{"status":"ok","timestamp":"2026-02-15T10:30:00.000Z"}
```

---

## 后续常用操作

以下是你可能需要的日常操作，每个操作都只需要一条命令。

### 更新代码（推送新版本后）

```bash
cd aurixai-website/deploy
chmod +x update.sh
./update.sh
```

### 查看服务运行状态

```bash
ssh root@你的ECS_IP "pm2 list"
```

### 查看实时日志

```bash
ssh root@你的ECS_IP "pm2 logs"
```

按 `Ctrl+C` 退出日志查看。

### 重启服务

```bash
ssh root@你的ECS_IP "pm2 restart all"
```

### 后续添加域名

如果你一开始没有配置域名，后续想添加，请按以下步骤操作：

1. 在阿里云 DNS 控制台添加一条 **A 记录**，将你的域名指向 ECS IP 地址
2. 等待 DNS 生效（通常 5-10 分钟）
3. 在终端执行：

```bash
ssh root@你的ECS_IP "certbot --nginx -d 你的域名 --non-interactive --agree-tos -m 你的邮箱"
```

---

## 阿里云安全组配置

如果访问不了服务，可能是安全组没有开放端口。请按以下步骤检查。

登录阿里云控制台，按照下方路径操作：

> 云服务器 ECS → 实例列表 → 点击你的实例 → 安全组 → 配置规则 → 入方向 → 添加安全组规则

需要开放的端口如下表所示：

| 端口 | 协议 | 用途 | 授权对象 |
|------|------|------|----------|
| 22 | TCP | SSH 远程登录 | 0.0.0.0/0 |
| 80 | TCP | HTTP 网站访问 | 0.0.0.0/0 |
| 443 | TCP | HTTPS 安全访问 | 0.0.0.0/0 |

---

## 遇到问题？

以下是常见问题及解决方法：

**问题：脚本执行时提示 "Permission denied"**

解决：确认你输入的是 root 密码，不是普通用户密码。如果忘记密码，在阿里云控制台重置。

**问题：访问 IP 地址没有响应**

解决：检查阿里云安全组是否开放了 80 端口（参考上方「安全组配置」章节）。

**问题：域名访问不了**

解决：确认 DNS A 记录已添加且已生效。可以在终端执行 `ping 你的域名` 检查是否解析到正确的 IP。

**问题：HTTPS 证书申请失败**

解决：确认域名已正确解析到 ECS IP，且 80 端口已开放。然后重新执行 certbot 命令。

---

## 架构说明

部署完成后，你的服务器上运行着以下组件：

```
用户请求 → Nginx (80/443) → AURIX API (端口 3000)
                                ↓
                           PM2 进程管理
                                ↓
                        事件追踪 → 仪表盘
```

Nginx 作为反向代理接收所有请求，转发给后端 Node.js 服务。PM2 负责进程管理、自动重启和日志收集。事件追踪服务会自动将业务数据上报到仪表盘。

所有代码部署在 `/opt/aurix` 目录下，日志文件在 `/var/log/aurix/` 目录下。
